(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[839],{114:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/courses/spring-security/lessons/appuser-authentication",function(){return c(3589)}])},4621:function(c,a,b){"use strict";var d=b(5893);a.Z=function(a){var c=a.src,b=a.title;return(0,d.jsxs)("div",{className:"p-3",children:[(0,d.jsx)("div",{className:"mb-3 text-secondary text-center",children:(0,d.jsx)("em",{children:b})}),(0,d.jsx)("img",{className:"img-fluid rounded border shadow",src:c,alt:b})]})}},3589:function(f,b,a){"use strict";a.r(b);var g=a(5893),h=a(9963),i=a(130),j=a(7291),k=a(476),l=a(4621),c=a(9827),d=a(9927),e=a(358);b.default=(0,c.default)(function(b){var a=b.githubPath;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("section",{children:[(0,g.jsx)(h.nL,{children:"Authentication with AppUser"}),(0,g.jsxs)(i.Z,{children:["So far we have authenticated using the default user and the random password provided by Spring Security. But as in any web applications we want to authenticate using our application users, which were created in the database by ",(0,g.jsx)(j.Z,{children:"AppDataInitialiser"})," when the application bootstraps. Let's see how we can do this using one of the implementations of ",(0,g.jsx)(j.Z,{children:"UserDetailsService"})," provided by Spring Security."]})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)(h.aC,{children:"InMemoryUserDetailsManager"}),(0,g.jsxs)(i.Z,{children:["Spring Security uses ",(0,g.jsx)(j.Z,{children:"UserDetailsService"})," as the core interface to load user-specific data by username, and it requires only one read-only method."]}),(0,g.jsx)(k.Z,{children:"\npublic interface UserDetailsService {\n    UserDetails loadUserByUsername(String username)\n            throws UsernameNotFoundException;\n}\n"}),(0,g.jsxs)(i.Z,{children:[(0,g.jsx)(j.Z,{children:"InMemoryUserDetailsManager"})," is one of the implementations provided by Spring Security. It is a non-persistant implementation backed by an in-memory map mainly intended for testing and demonstration purposes only. It accepts a collection of ",(0,g.jsx)(j.Z,{children:"UserDetails"})," objects, which is the same as the return type of the above ",(0,g.jsx)(j.Z,{children:"loadUserByUsername()"})," method."]})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)(h.aC,{children:"Create UserDetails from database"}),(0,g.jsxs)(i.Z,{children:["Before registering ",(0,g.jsx)(j.Z,{children:"InMemoryUserDetailsManager"})," bean, let's create a collection of ",(0,g.jsx)(j.Z,{children:"UserDetails"})," objects. We can do this by fetching all the ",(0,g.jsx)(j.Z,{children:"AppUser"})," records from the database, map them all with ",(0,g.jsx)(j.Z,{children:"User"})," class and return the collection from a ",(0,g.jsx)(j.Z,{children:"@Service"})," method like below."]}),(0,g.jsx)(k.Z,{fileName:"DbUserDetailsService.java",href:a+"/src/main/java/com/facadecode/spring/security/service/DbUserDetailsService.java",children:'\n@Service\npublic class DbUserDetailsService {\n    @Autowired\n    private AppUserRepository appUserRepository;\n\n    public List<UserDetails> getAllUserDetails() {\n        return appUserRepository.findAll()\n                .stream()\n                .map(appUser -> User.builder()\n                        .username(appUser.getUsername())\n                        .password(String.format("{noop}%s", appUser.getPassword()))\n                        .authorities(Collections.EMPTY_SET)\n                        .build()\n                )\n                .collect(Collectors.toList());\n    }\n}\n'}),(0,g.jsxs)(i.Z,{children:[(0,g.jsx)(j.Z,{children:"User"})," is one of the implementations of ",(0,g.jsx)(j.Z,{children:"UserDetails"})," interface with a convenient Builder class. Here we have mapped ",(0,g.jsx)("em",{children:"username"})," and ",(0,g.jsx)("em",{children:"password"})," only and left the authorities as an empty ",(0,g.jsx)(j.Z,{children:"Set"})," as we are focusing only on authenticating application users for now."]}),(0,g.jsxs)(i.Z,{children:["We must provide the correct password encoding schema used to encode the passwords stored in the database. We can do this by prefixing each password with the appropriate string literal representing the ",(0,g.jsx)(j.Z,{children:"PasswordEncoder"}),". In our case we have not encrypted the passwords in the database, we are prefixing it with ",(0,g.jsx)(j.Z,{children:"{noop}"}),". This prefix tells Spring Security to use ",(0,g.jsx)(j.Z,{children:"NoOpPasswordEncoder"})," for password verification while authenticating the application user."]})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)(h.aC,{children:"Register InMemoryUserDetailsManager Bean"}),(0,g.jsxs)(i.Z,{children:["Now with the list of ",(0,g.jsx)(j.Z,{children:"UserDetails"})," objects in hand, we can create and register an ",(0,g.jsx)(j.Z,{children:"InMemoryUserDetailsManager"})," bean inside a new ",(0,g.jsx)(j.Z,{children:"@Configuration"})," class like below."]}),(0,g.jsx)(k.Z,{fileName:"SecurityBean.java",href:a+"/src/main/java/com/facadecode/spring/security/config/SecurityBean.java",children:"\n@Configuration\npublic class SecurityBean {\n    @Autowired\n    private DbUserDetailsService dbUserDetailsService;\n\n    @Bean\n    public UserDetailsService userDetailsService() {\n        return new InMemoryUserDetailsManager(\n                dbUserDetailsService.getAllUserDetails()\n        );\n    }\n}\n"})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)(h.aC,{children:"Verify authentication using AppUser"}),(0,g.jsxs)(i.Z,{children:["When we restart the application, we can notice Spring Security is no longer generating the random password. And it no longer creates the default user also. It uses ",(0,g.jsx)(j.Z,{children:"InMemoryUserDetailsManager"})," bean to hold the list of ",(0,g.jsx)(j.Z,{children:"UserDetails"})," mapped from the ",(0,g.jsx)(j.Z,{children:"AppUser"})," records in the database."]}),(0,g.jsxs)(i.Z,{children:["We can use any of these AppUser from the database to authenticate in order to access the secured REST APIs. Let's use Bob and his credential to access the ",(0,g.jsx)("u",{children:"ListStudents"})," API in Postman using Basic Auth."]}),(0,g.jsx)(l.Z,{src:"/assets/images/spring-security/lesson05-02.png",title:"List of all student records returned for the application user (Bob)"})]})]})},(0,e.s)(d.Z,"appuser-authentication"))}},function(a){a.O(0,[116,891,637,462,774,888,179],function(){var b;return a(a.s=114)}),_N_E=a.O()}])