(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[559],{6919:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/courses/spring-security/lessons/db-backed-userdetailsservice",function(){return c(2508)}])},2018:function(d,b,a){"use strict";var e=a(5893),c=a(5927),f=a.n(c);b.Z=function(a){var c=a.href,d=a.children,b=a.target;return(0,e.jsxs)("a",{href:c,target:void 0===b?"":b,className:"text-decoration-none","data-bs-toggle":"tooltip","data-bs-title":"Read article",children:[(0,e.jsx)("i",{className:"bi bi-file-text ".concat(f().linkIcon)}),(0,e.jsx)("span",{className:f().linkText,children:d})]})}},476:function(d,b,a){"use strict";var e=a(7568),c=a(4051),f=a.n(c),g=a(5893),h=a(637),i=a(7294),j=a(1896);b.Z=function(a){var l,b=a.fileName,m=a.href,c=a.language,d=void 0===c?"java":c,n=a.children,k=(0,i.useState)(!1),o=k[0],q=k[1],p=(l=(0,e.Z)(f().mark(function a(){return f().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,navigator.clipboard.writeText(n);case 2:q(!0),setTimeout(function(){return q(!1)},6e3);case 4:case"end":return a.stop()}},a)})),function(){return l.apply(this,arguments)});return(0,g.jsxs)("div",{className:"border rounded fs-6 my-4",children:[b&&(0,g.jsxs)("div",{className:"p-3 bg-light border-bottom",children:[(0,g.jsx)("span",{className:"font-monospace",children:(0,g.jsx)("a",{href:m,target:"_blank",children:b})}),(0,g.jsx)("span",{className:"float-end cursor-pointer","data-bs-toggle":"tooltip","data-bs-title":"Copy code",onClick:p,children:(0,g.jsx)("i",{className:"bi-clipboard"})})]}),(0,g.jsx)("pre",{className:"m-0 px-3 pb-3",children:(0,g.jsx)("code",{className:"language-".concat(d),children:(0,g.jsx)("span",{dangerouslySetInnerHTML:{__html:h.Z.highlight(n,{language:d}).value}})})}),o&&(0,g.jsx)(j.Z,{children:"Code copied to clipboard"})]})}},9963:function(d,b,a){"use strict";a.d(b,{aC:function(){return h},k8:function(){return i},nL:function(){return g}});var e=a(5893),c=a(4046),f=a.n(c);function g(a){var b=a.children;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("h1",{className:"display-5 mt-2 mb-2",children:b}),(0,e.jsx)("p",{className:f().underline})]})}function h(a){var b=a.children;return(0,e.jsx)("h3",{className:"fw-light mt-5 mb-2",children:b})}function i(a){var b=a.children;return(0,e.jsx)("h4",{className:"fw-light mt-5 mb-2",children:b})}},7291:function(d,b,a){"use strict";var e=a(5893),c=a(9472),f=a.n(c);b.Z=function(a){var b=a.children;return(0,e.jsx)("mark",{className:"font-monospace border rounded p-1 ".concat(f().mark),children:b})}},6614:function(d,b,a){"use strict";var e=a(5893),c=a(3394),f=a.n(c);b.Z=function(a){var b=a.title,c=a.children;return(0,e.jsxs)("section",{className:"px-3 pt-1 my-5 ".concat(f().notes),children:[(0,e.jsxs)("h4",{className:"mb-3",children:[(0,e.jsx)("i",{className:"bi bi-info-circle me-2"}),void 0===b?"Note":b]}),c]})}},9927:function(b,a){"use strict";a.Z={title:"Spring Security",path:"/courses/spring-security",contextPath:"courses/spring-security/lessons/",githubPath:"https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/",lessons:[{title:"Introduction",path:"introduction",part:"I. Bootstrap The Application"},{title:"Install Spring Security",path:"install-spring-security",part:"I. Bootstrap The Application"},{title:"Enable Basic Auth",path:"enable-basic-auth",part:"I. Bootstrap The Application"},{title:"Authentication with AppUser",path:"appuser-authentication",part:"I. Bootstrap The Application"},{title:"Password Encoder",path:"password-encoder",part:"I. Bootstrap The Application"},{title:"Permit Public APIs",path:"permit-public-apis",part:"II. Web Layer Security - Role Based Authorization"},{title:"Role Based Authorization",path:"role-based-authorization",part:"II. Web Layer Security - Role Based Authorization"},{title:"Disable CSRF",path:"disable-csrf",part:"II. Web Layer Security - Role Based Authorization"},{title:"Current Authenticated User",path:"current-authenticated-user",part:"II. Web Layer Security - Role Based Authorization"},{title:"Permission Based Authorization",path:"permission-based-authorization",part:"III. Web Layer Security - Permission Based Authorization"},{title:"Define Permissions",path:"define-permissions",part:"III. Web Layer Security - Permission Based Authorization"},{title:"Assign Permissions",path:"assign-permissions",part:"III. Web Layer Security - Permission Based Authorization"},{title:"Remove Role Based Access",path:"remove-role-based-access",part:"III. Web Layer Security - Permission Based Authorization"},{title:"PreAuthorize",path:"pre-authorize",part:"IV. Service Layer Security"},{title:"PostAuthorize",path:"post-authorize",part:"IV. Service Layer Security"},{title:"Authorize Using Spring Beans",path:"authorize-using-spring-beans",part:"IV. Service Layer Security"},{title:"Domain Object Instance Security",path:"domain-object-instance-security",part:"V. Domain Object Instance Security"},{title:"PermissionEvaluator Interface",path:"permission-evaluator-interface",part:"V. Domain Object Instance Security"},{title:"PermissionEvaluator Strategy",path:"permission-evaluator-strategy",part:"V. Domain Object Instance Security"},{title:"DB Backed UserDetailsService",path:"db-backed-userdetailsservice",part:"V. Domain Object Instance Security"},{title:"Basic Authentication Revisited",path:"basic-authentication-revisited",part:"VI. Token Based Authentication"},{title:"Generate Token",path:"generate-token",part:"VI. Token Based Authentication"},{title:"Persist Token",path:"persist-token",part:"VI. Token Based Authentication"},{title:"Verify Token",path:"verify-token",part:"VI. Token Based Authentication"},{title:"Invalidate Token",path:"invalidate-token",part:"VI. Token Based Authentication"},{title:"JSON Web Token",path:"json-web-token",part:"VII. Token Based Authentication and Authorization"},{title:"Generate JWT",path:"generate-jwt",part:"VII. Token Based Authentication and Authorization"},{title:"Verify JWT",path:"verify-jwt",part:"VII. Token Based Authentication and Authorization"}]}},2508:function(f,b,a){"use strict";a.r(b);var g=a(5893),h=a(9963),i=a(130),j=a(7291),k=a(476),c=a(9827),d=a(9927),e=a(358),l=a(6614),m=a(2018);b.default=(0,c.default)(function(a){var b=a.githubPath;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("section",{children:[(0,g.jsx)(h.nL,{children:"Database Backed UserDetailsService"}),(0,g.jsxs)(i.Z,{children:["Remember we are using ",(0,g.jsx)(j.Z,{children:"InMemoryUserDetailsManager"}),", the default non-persistant implementation of ",(0,g.jsx)(j.Z,{children:"UserDetailsService"})," provided by Spring Security. It is mainly intended for testing and demonstration purposes. Any change in the user details in the database requires us to restart the application. We need an implementation backed by database for production."]})]}),(0,g.jsxs)("section",{children:[(0,g.jsx)(h.aC,{children:"UserDetailsService"}),(0,g.jsxs)(i.Z,{children:[(0,g.jsx)(j.Z,{children:"UserDetailsService"})," is used by ",(0,g.jsx)(m.Z,{href:"https://docs.spring.io/spring-security/reference/servlet/authentication/passwords/dao-authentication-provider.html#servlet-authentication-daoauthenticationprovider",target:"_blank",children:"DaoAuthenticationProvider"})," for retrieving a username, password, and other attributes for authenticating with a username and password. We can define custom authentication by exposing a custom ",(0,g.jsx)(j.Z,{children:"UserDetailsService"})," as a bean."]}),(0,g.jsxs)(i.Z,{children:["Let's implement it using our ",(0,g.jsx)(j.Z,{children:"DbUserDetailsService"})," bean by overriding the ",(0,g.jsx)(j.Z,{children:"loadUserByUsername()"})," method."]}),(0,g.jsx)(k.Z,{fileName:"DbUserDetailsService.java",href:b+"/src/main/java/com/facadecode/spring/security/service/DbUserDetailsService.java",children:'\n@Service\npublic class DbUserDetailsService implements UserDetailsService {\n    // Other details omitted for brevity\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        AppUser appUser = appUserRepository.findByUsername(username)\n                .orElseThrow(() -> new UsernameNotFoundException(String.format("User %s not found", username)));\n\n        return User.builder()\n                .username(appUser.getUsername())\n                .password(appUser.getPassword())\n                .authorities(this.getPermissions(appUser.getRoles()))\n                .build();\n    }\n}\n'}),(0,g.jsxs)(i.Z,{children:["Here we are using ",(0,g.jsx)(j.Z,{children:"AppUserRepository"})," to find the user by ",(0,g.jsx)("em",{children:"username"})," from the database. And then we are returning the ",(0,g.jsx)(j.Z,{children:"UserDetails"})," object mapped from the ",(0,g.jsx)(j.Z,{children:"AppUser"})," object."]}),(0,g.jsxs)(i.Z,{children:["Once we remove the ",(0,g.jsx)(j.Z,{children:"InMemoryUserDetailsManager"})," bean from ",(0,g.jsx)(j.Z,{children:"SecurityBean"})," configuration, ",(0,g.jsx)(j.Z,{children:"DaoAuthenticationProvider"})," will automatically use the ",(0,g.jsx)(j.Z,{children:"DbUserDetailsService"})," component to load the user by ",(0,g.jsx)("em",{children:"username"})," for authentication. And we can also remove the existing ",(0,g.jsx)(j.Z,{children:"loadAllUserDetails()"})," method as it is no longer required."]}),(0,g.jsx)(l.Z,{children:(0,g.jsxs)(i.Z,{children:["Please note there is no change in the security restrictions we have applied so far as we have just swapped the ",(0,g.jsx)(j.Z,{children:"UserDetailsService"})," implementation from non-persistant datastore to persistant datastore."]})})]})]})},(0,e.s)(d.Z,"db-backed-userdetailsservice"))},5927:function(a){a.exports={linkIcon:"ArticleLink_linkIcon__cf7b_",linkText:"ArticleLink_linkText__b7K5H"}},4046:function(a){a.exports={heading:"Heading_heading__aP_DN",underline:"Heading_underline__sSwtx"}},9472:function(a){a.exports={mark:"Mark_mark__8gh_T"}},3394:function(a){a.exports={notes:"Notes_notes__up3CK"}}},function(a){a.O(0,[116,734,92,637,827,774,888,179],function(){var b;return a(a.s=6919)}),_N_E=a.O()}])