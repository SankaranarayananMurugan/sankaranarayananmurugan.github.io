<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/ff92f81931bd1587.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff92f81931bd1587.css" data-n-g=""/><link rel="preload" href="/_next/static/css/9ec6a016ade6bb0b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9ec6a016ade6bb0b.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-3fc813d5b2b35cef.js" defer=""></script><script src="/_next/static/chunks/framework-ae4f43955bfa5ddc.js" defer=""></script><script src="/_next/static/chunks/main-3cf1b4d0a841b0b4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-32643fc599d68fc0.js" defer=""></script><script src="/_next/static/chunks/116-e8f82ba66f2c41a9.js" defer=""></script><script src="/_next/static/chunks/891-9e24b7718d5823e8.js" defer=""></script><script src="/_next/static/chunks/637-6dfba56d742f678a.js" defer=""></script><script src="/_next/static/chunks/462-395f7d23cac5ec2e.js" defer=""></script><script src="/_next/static/chunks/pages/courses/spring-security/lessons/permit-public-apis-d33339d26d6c2a50.js" defer=""></script><script src="/_next/static/QcPToEk8jGA_qcC-TjE0b/_buildManifest.js" defer=""></script><script src="/_next/static/QcPToEk8jGA_qcC-TjE0b/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="header_header___GOuZ sticky-top"><div class="container"><div class="logo_logo__RXjG7 text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div></header><main class="my-3"><div class="container"><section class="header_lessonHeader__jhqot"><div class="float-start">Lesson <!-- -->6<!-- --> of <!-- -->28</div><div class="float-end"><a href="/courses/spring-security">Spring Security</a></div></section><div class="clearfix"></div><div class="mt-5"><div class="float-end"><a href="#" target="_blank" class="icon-link"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/permit-public-apis" target="_blank" class="icon-link"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><section><h1 class="display-5 mt-2 mb-2">Permit Public APIs</h1><p class="Heading_underline__sSwtx"></p><p class="Paragraph_paragraph__90U8D">We are now aware that the default behaviour of Spring Security secures all the resources. In addition we have configured <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">HttpSecurity</mark> to authenticate any HTTP requests using Basic Auth. This enforced us to provide <em>username</em> and <em>password</em> everytime we access an API in order to authenticate ourselves, failing to provide them resulted in <em>401 Unauthorized</em> error.</p><p class="Paragraph_paragraph__90U8D">However, <u>ListCourses</u> and <u>GetCourse</u> APIs are open for anyone to access without authentication. In this chapter we will relax the access restriction for these APIs using <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">antMatchers()</mark>.</p><p class="Paragraph_paragraph__90U8D">First let&#x27;s add the Public API urls in a constant class like below:</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/blob/permit-public-apis/src/main/java/com/facadecode/spring/security/constant/SecurityConstants.java" target="_blank">SecurityConstants.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" title="Copy to clipboard"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityConstants</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">API_LIST_COURSES</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/api/v1/courses&quot;</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">API_GET_COURSE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/api/v1/courses/*&quot;</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] PUBLIC_API_LIST = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] {
        API_LIST_COURSES,
        API_GET_COURSE
    };
};
</span></code></pre></div></section><section><h3 class="fw-light mt-5 mb-2">AntMatchers</h3><p class="Paragraph_paragraph__90U8D"><mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">antMatchers()</mark> are overloaded methods to configure restrictions for specific urls matching the provided antPattern urls. We can either chain them together with <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">authorizeRequests()</mark> or pass it as an argument to the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">authorizeRequests()</mark> in the form of lambda expression.</p><p class="Paragraph_paragraph__90U8D">Here we are going to use one of the overloaded methods which accepts both <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">HttpMethod</mark> and antPattern urls: <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">antMatchers(HttpMethod, String...)</mark></p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/blob/permit-public-apis/src/main/java/com/facadecode/spring/security/config/ApiSecurityConfig.java" target="_blank">ApiSecurityConfig.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" title="Copy to clipboard"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>      
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiSecurityConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SecurityFilterChain <span class="hljs-title function_">apiFilterChain</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
        http
            .authorizeRequests(auth -&gt; auth
                .antMatchers(GET, PUBLIC_API_LIST).permitAll()
                .anyRequest().authenticated()
            )
            .httpBasic();
        <span class="hljs-keyword">return</span> http.build();
    }
} 
</span></code></pre></div><p class="Paragraph_paragraph__90U8D">As <u>ListCourses</u> and <u>CreateCourse</u> endpoints are the same but with different HttpMethod, we have to specify <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">HttpMethod.GET</mark> in the antMatchers to permit only the <u>ListCourses</u> API.</p><p class="Paragraph_paragraph__90U8D">The order in which the antMatchers are defined is important, with most restricted resources defined at the top followed by least restricted resources at the bottom.</p></section><section><h3 class="fw-light mt-5 mb-2">Test Public APIs</h3><p class="Paragraph_paragraph__90U8D">Restart the application and access the two Public APIs from Postman by selecting <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">No Auth</mark> option in the Authorization tab. With No Auth we are not required to provide <em>username</em> and <em>password</em>. And we can notice the APIs returning the expected response with no authentication required anymore.</p><div class="p-3"><div class="mb-3 text-secondary text-center"><em>List of courses returned with No Auth</em></div><img class="img-fluid rounded border shadow" src="/assets/images/spring-security/lesson04-01.png" alt="List of courses returned with No Auth"/></div></section><div class="mt-5"><div class="float-end text-secondary"><a href="#" target="_blank" class="icon-link"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/permit-public-apis" target="_blank" class="icon-link"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><hr class=""/><section><p class="Paragraph_paragraph__90U8D"><span class="float-start"><a href="password-encoder"><i class="bi-arrow-left-short mx-1 align-middle footer_icon__J1tGG"></i>Password Encoder</a></span><span class="float-end"><a href="role-based-authorization">Role Based Authorization<i class="bi-arrow-right-short mx-1 align-middle footer_icon__J1tGG"></i></a></span></p><div class="clearfix"></div></section></div></main><footer class="footer_footer__0KXQq"><div class="mt-5 py-5 text-center fw-lighter text-light bg-secondary"><div class="container"><figure><blockquote class="blockquote">I’m not a great programmer; I’m just a good programmer with great habits</blockquote><figcaption class="blockquote-footer text-light">Kent Beck</figcaption></figure></div></div><div class="py-5 bg-dark"><div class="container"><div class="row"><div class="col-9"><div class="logo_logo__RXjG7 text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div><div class="col"><strong>COURSES</strong><ul class="list-unstyled p-0"><li class="my-2"><a href="/courses/spring-security">Spring Security</a></li></ul></div></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/courses/spring-security/lessons/permit-public-apis","query":{},"buildId":"QcPToEk8jGA_qcC-TjE0b","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>