<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/ff92f81931bd1587.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff92f81931bd1587.css" data-n-g=""/><link rel="preload" href="/_next/static/css/9ec6a016ade6bb0b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9ec6a016ade6bb0b.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-534f50ab9154eb69.js" defer=""></script><script src="/_next/static/chunks/framework-ae4f43955bfa5ddc.js" defer=""></script><script src="/_next/static/chunks/main-3cf1b4d0a841b0b4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-32643fc599d68fc0.js" defer=""></script><script src="/_next/static/chunks/116-e8f82ba66f2c41a9.js" defer=""></script><script src="/_next/static/chunks/891-9e24b7718d5823e8.js" defer=""></script><script src="/_next/static/chunks/637-6dfba56d742f678a.js" defer=""></script><script src="/_next/static/chunks/462-29b379b3475d5b09.js" defer=""></script><script src="/_next/static/chunks/pages/courses/spring-security/lessons/appuser-authentication-38b69facab777d24.js" defer=""></script><script src="/_next/static/AKH-6cpO_lfOqlDA3-gc2/_buildManifest.js" defer=""></script><script src="/_next/static/AKH-6cpO_lfOqlDA3-gc2/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="header_header___GOuZ sticky-top"><div class="container"><div class="logo_logo__RXjG7 text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div></header><main class="my-3"><div class="container"><section class="header_lessonHeader__jhqot"><div class="float-start">Lesson <!-- -->4<!-- --> of <!-- -->28</div><div class="float-end"><a href="/courses/spring-security">Spring Security</a></div></section><div class="clearfix"></div><div class="mt-5"><div class="float-end"><a href="#" target="_blank" class="icon-link"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/appuser-authentication" target="_blank" class="icon-link"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><section><h1 class="display-5 mt-2 mb-2">Authentication with AppUser</h1><p class="Heading_underline__sSwtx"></p><p class="Paragraph_paragraph__90U8D">So far we have authenticated using the default user and the random password provided by Spring Security. But as in any web applications we want to authenticate using our application users, which were created in the database by <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">AppDataInitialiser</mark> when the application bootstraps. Let&#x27;s see how we can do this using one of the implementations of <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetailsService</mark> provided by Spring Security.</p></section><section><h3 class="fw-light mt-5 mb-2">InMemoryUserDetailsManager</h3><p class="Paragraph_paragraph__90U8D">Spring Security uses <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetailsService</mark> as the core interface to load user-specific data by username, and it requires only one read-only method.</p><div class="border rounded fs-6 my-4"><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDetailsService</span> {
    UserDetails <span class="hljs-title function_">loadUserByUsername</span><span class="hljs-params">(String username)</span>
            <span class="hljs-keyword">throws</span> UsernameNotFoundException;
}
</span></code></pre></div><p class="Paragraph_paragraph__90U8D"><mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">InMemoryUserDetailsManager</mark> is one of the implementations provided by Spring Security. It is a non-persistant implementation backed by an in-memory map mainly intended for testing and demonstration purposes only. It accepts a collection of <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetails</mark> objects, which is the same as the return type of the above <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">loadUserByUsername()</mark> method.</p></section><section><h3 class="fw-light mt-5 mb-2">Create UserDetails from database</h3><p class="Paragraph_paragraph__90U8D">Before registering <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">InMemoryUserDetailsManager</mark> bean, let&#x27;s create a collection of <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetails</mark> objects. We can do this by fetching all the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">AppUser</mark> records from the database, map them all with <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">User</mark> class and return the collection from a <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">@Service</mark> method like below.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/blob/appuser-authentication/src/main/java/com/facadecode/spring/security/service/DbUserDetailsService.java" target="_blank">DbUserDetailsService.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" title="Copy to clipboard"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DbUserDetailsService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AppUserRepository appUserRepository;

    <span class="hljs-keyword">public</span> List&lt;UserDetails&gt; <span class="hljs-title function_">getAllUserDetails</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> appUserRepository.findAll()
                .stream()
                .map(appUser -&gt; User.builder()
                        .username(appUser.getUsername())
                        .password(String.format(<span class="hljs-string">&quot;{noop}%s&quot;</span>, appUser.getPassword()))
                        .authorities(Collections.EMPTY_SET)
                        .build()
                )
                .collect(Collectors.toList());
    }
}
</span></code></pre></div><p class="Paragraph_paragraph__90U8D"><mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">User</mark> is one of the implementations of <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetails</mark> interface with a convenient Builder class. Here we have mapped <em>username</em> and <em>password</em> only and left the authorities as an empty <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">Set</mark> as we are focusing only on authenticating application users for now.</p><p class="Paragraph_paragraph__90U8D">We must provide the correct password encoding schema used to encode the passwords stored in the database. We can do this by prefixing each password with the appropriate string literal representing the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">PasswordEncoder</mark>. In our case we have not encrypted the passwords in the database, we are prefixing it with <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">{noop}</mark>. This prefix tells Spring Security to use <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">NoOpPasswordEncoder</mark> for password verification while authenticating the application user.</p></section><section><h3 class="fw-light mt-5 mb-2">Register InMemoryUserDetailsManager Bean</h3><p class="Paragraph_paragraph__90U8D">Now with the list of <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetails</mark> objects in hand, we can create and register an <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">InMemoryUserDetailsManager</mark> bean inside a new <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">@Configuration</mark> class like below.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/blob/appuser-authentication/src/main/java/com/facadecode/spring/security/config/SecurityBean.java" target="_blank">SecurityBean.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" title="Copy to clipboard"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityBean</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DbUserDetailsService dbUserDetailsService;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> UserDetailsService <span class="hljs-title function_">userDetailsService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryUserDetailsManager</span>(
                dbUserDetailsService.getAllUserDetails()
        );
    }
}
</span></code></pre></div></section><section><h3 class="fw-light mt-5 mb-2">Verify authentication using AppUser</h3><p class="Paragraph_paragraph__90U8D">When we restart the application, we can notice Spring Security is no longer generating the random password. And it no longer creates the default user also. It uses <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">InMemoryUserDetailsManager</mark> bean to hold the list of <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetails</mark> mapped from the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">AppUser</mark> records in the database.</p><p class="Paragraph_paragraph__90U8D">We can use any of these AppUser from the database to authenticate in order to access the secured REST APIs. Let&#x27;s use Bob and his credential to access the <u>ListStudents</u> API in Postman using Basic Auth.</p><div class="p-3"><div class="mb-3 text-secondary text-center"><em>List of all student records returned for the application user (Bob)</em></div><img class="img-fluid rounded border shadow" src="/assets/images/spring-security/lesson05-02.png" alt="List of all student records returned for the application user (Bob)"/></div></section><div class="mt-5"><div class="float-end text-secondary"><a href="#" target="_blank" class="icon-link"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/appuser-authentication" target="_blank" class="icon-link"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><hr class=""/><section><p class="Paragraph_paragraph__90U8D"><span class="float-start"><a href="enable-basic-auth"><i class="bi-arrow-left-short mx-1 align-middle footer_icon__J1tGG"></i>Enable Basic Auth</a></span><span class="float-end"><a href="password-encoder">Password Encoder<i class="bi-arrow-right-short mx-1 align-middle footer_icon__J1tGG"></i></a></span></p><div class="clearfix"></div></section></div></main><footer class="footer_footer__0KXQq"><div class="mt-5 py-5 text-center fw-lighter text-light bg-secondary"><div class="container"><figure><blockquote class="blockquote">I’m not a great programmer; I’m just a good programmer with great habits</blockquote><figcaption class="blockquote-footer text-light">Kent Beck</figcaption></figure></div></div><div class="py-5 bg-dark"><div class="container"><div class="row"><div class="col-9"><div class="logo_logo__RXjG7 text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div><div class="col"><strong>COURSES</strong><ul class="list-unstyled p-0"><li class="my-2"><a href="#">Spring Security</a></li></ul></div></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/courses/spring-security/lessons/appuser-authentication","query":{},"buildId":"AKH-6cpO_lfOqlDA3-gc2","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>