<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/ff92f81931bd1587.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff92f81931bd1587.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cd6432f52d876389.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cd6432f52d876389.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-7269df826c4d1d8b.js" defer=""></script><script src="/_next/static/chunks/framework-ae4f43955bfa5ddc.js" defer=""></script><script src="/_next/static/chunks/main-3cf1b4d0a841b0b4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4e35396f25479038.js" defer=""></script><script src="/_next/static/chunks/116-e8f82ba66f2c41a9.js" defer=""></script><script src="/_next/static/chunks/734-501744163e7117ce.js" defer=""></script><script src="/_next/static/chunks/92-440e540aa7fbcfdf.js" defer=""></script><script src="/_next/static/chunks/637-485e8fd7a429178a.js" defer=""></script><script src="/_next/static/chunks/827-6a9167eb1a9387e0.js" defer=""></script><script src="/_next/static/chunks/pages/courses/spring-security/lessons/password-encoder-ba827b495343522f.js" defer=""></script><script src="/_next/static/_e-p_C0xJot5hRdMGnMZh/_buildManifest.js" defer=""></script><script src="/_next/static/_e-p_C0xJot5hRdMGnMZh/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="header_header___GOuZ sticky-top"><div class="container"><div class="logo_logo__RXjG7 text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div></header><main class="my-3"><div class="container"><section class="header_lessonHeader__jhqot"><div class="float-start">Lesson <!-- -->5<!-- --> of <!-- -->28</div><div class="float-end"><a href="/courses/spring-security">Spring Security</a></div></section><div class="clearfix"></div><div class="mt-5"><div class="float-end"><a href="#" target="_blank" class="icon-link" data-bs-toggle="tooltip" data-bs-title="Download patch"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/password-encoder" target="_blank" class="icon-link" data-bs-toggle="tooltip" data-bs-title="Github repository"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link" data-bs-toggle="tooltip" data-bs-title="Copy link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><section><h1 class="display-5 mt-2 mb-2">Password Encoder</h1><p class="Heading_underline__sSwtx"></p><p class="Paragraph_paragraph__90U8D">In the last chapter, we mentioned that we have not encrypted the password for any users in the database. You might also have noticed from the <u>ListStudents</u> API response that the passwords are all just plain text.</p><p class="Paragraph_paragraph__90U8D">Storing passwords in plain text is a terrible idea that any level of database compromise will expose your application users. It could be logging the passwords by mistake or inadequately securing the database dumps etc., We must encrypt the password using irreversible cryptographic functions that even the system / database administrators could not retrieve them.</p><p class="Paragraph_paragraph__90U8D">In this chapter, we will introduce the most commonly used <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">BCryptPasswordEncoder</mark> offered by Spring Security.</p></section><section><h3 class="fw-light mt-5 mb-2">BCryptPasswordEncoder</h3><p class="Paragraph_paragraph__90U8D"><mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">BCryptPasswordEncoder</mark> is one of the implementations of the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">PasswordEncoder</mark> interface. It helps us to <em>encode</em> the password as well as <em>match</em> the raw password with the encoded password on authentication.</p><p class="Paragraph_paragraph__90U8D">Let&#x27;s create and register <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">BCryptPasswordEncoder</mark> bean in the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">SecurityBean</mark> class.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/blob/password-encoder/src/main/java/com/facadecode/spring/security/config/SecurityBean.java" target="_blank">SecurityBean.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" data-bs-title="Copy code"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title function_">passwordEncoder</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();
}
</span></code></pre></div></section><section><h3 class="fw-light mt-5 mb-2">Encrypt the passwords</h3><p class="Paragraph_paragraph__90U8D">Autowire the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">PasswordEncoder</mark> in <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">AppDataInitialiser</mark>, and then use it to encrypt the password for all the users before saving it in the database like below:</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/blob/password-encoder/src/main/java/com/facadecode/spring/security/config/AppDataInitialiser.java" target="_blank">AppDataInitialiser.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" data-bs-title="Copy code"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-type">AppUser</span> <span class="hljs-variable">gruUser</span> <span class="hljs-operator">=</span> AppUser.builder()
        .username(<span class="hljs-string">&quot;Gru&quot;</span>)
        .password(passwordEncoder.encode(<span class="hljs-string">&quot;password&quot;</span>))
        .email(<span class="hljs-string">&quot;gru@email.com&quot;</span>)
        .roles(Collections.singleton(instructorRole))
        .build();
</span></code></pre></div><p class="Paragraph_paragraph__90U8D">Restarting the application triggers <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">AppDataInitialiser</mark> to clear the database and recreate all the user records with encrypted passwords.</p></section><section><h3 class="fw-light mt-5 mb-2">Update UserDetails</h3><p class="Paragraph_paragraph__90U8D">In order to let Spring Security know that we have used <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">BCryptPasswordEncoder</mark> to encrypt the passwords, we might think to replace the prefix for each password from <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">{noop}</mark> to <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">{bcrypt}</mark>. But it is no longer required as Spring Security is already aware of the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">PasswordEncoder</mark> bean available in the ApplicationContext. Let&#x27;s remove the prefix and map the password directly while creating the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">UserDetails</mark> list in <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">DbUserDetailsService</mark>.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/blob/password-encoder/src/main/java/com/facadecode/spring/security/service/DbUserDetailsService.java" target="_blank">DbUserDetailsService.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" data-bs-title="Copy code"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-keyword">public</span> List&lt;UserDetails&gt; <span class="hljs-title function_">getAllUserDetails</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> appUserRepository.findAll()
            .stream()
            .map(appUser -&gt; User.builder()
                    .username(appUser.getUsername())
                    .password(appUser.getPassword())
                    .authorities(Collections.EMPTY_SET)
                    .build()
            )
            .collect(Collectors.toList());
}
</span></code></pre></div><p class="Paragraph_paragraph__90U8D">In addition to encrypting the passwords, <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">BCryptPasswordEncoder</mark> bean will be automatically used by Spring Security for password verification also using <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">matches()</mark> method.</p><p class="Paragraph_paragraph__90U8D">Restart the application and send a GET request to the <u>ListStudents</u> API from Postman as Bob user. You can see from the response that all the passwords are encrypted now.</p><div class="p-3"><div class="mb-3 text-secondary text-center"><em>Passwords are encrypted for all the users</em></div><img class="img-fluid rounded border shadow" src="/assets/images/spring-security/lesson06-01.png" alt="Passwords are encrypted for all the users"/></div><p class="Paragraph_paragraph__90U8D">Though the passwords are encrypted, it is still not a good practice to expose them in any manner. Let&#x27;s add <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">@JsonIgnore</mark> annotation to the <em>password</em> field in <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">AppUser</mark> entity to ignore serializing it.</p><div class="p-3"><div class="mb-3 text-secondary text-center"><em>Passwords are removed from the response</em></div><img class="img-fluid rounded border shadow" src="/assets/images/spring-security/lesson06-02.png" alt="Passwords are removed from the response"/></div></section><div class="mt-5"><div class="float-end text-secondary"><a href="#" target="_blank" class="icon-link" data-bs-toggle="tooltip" data-bs-title="Download patch"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/password-encoder" target="_blank" class="icon-link" data-bs-toggle="tooltip" data-bs-title="Github repository"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link" data-bs-toggle="tooltip" data-bs-title="Copy link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><hr class=""/><section><p class="Paragraph_paragraph__90U8D"><span class="float-start"><i class="bi-arrow-left-short mx-1 align-middle footer_icon__J1tGG"></i><a href="/courses/spring-security/lessons/appuser-authentication">Authentication with AppUser</a></span><span class="float-end"><a href="/courses/spring-security/lessons/permit-public-apis">Permit Public APIs</a><i class="bi-arrow-right-short mx-1 align-middle footer_icon__J1tGG"></i></span></p><div class="clearfix"></div></section></div></main><footer class="footer_footer__0KXQq"><div class="mt-5 py-5 text-center fw-lighter text-light bg-secondary"><div class="container"><figure><blockquote class="blockquote">I’m not a great programmer; I’m just a good programmer with great habits</blockquote><figcaption class="blockquote-footer text-light">Kent Beck</figcaption></figure></div></div><div class="py-5 bg-dark"><div class="container"><div class="row"><div class="col-9"><div class="logo_logo__RXjG7 text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div><div class="col"><strong>COURSES</strong><ul class="list-unstyled p-0"><li class="my-2"><a href="/courses/spring-security">Spring Security</a></li></ul></div></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/courses/spring-security/lessons/password-encoder","query":{},"buildId":"_e-p_C0xJot5hRdMGnMZh","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>