<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/ff92f81931bd1587.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff92f81931bd1587.css" data-n-g=""/><link rel="preload" href="/_next/static/css/01b065b5c84bc69d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/01b065b5c84bc69d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-534f50ab9154eb69.js" defer=""></script><script src="/_next/static/chunks/framework-ae4f43955bfa5ddc.js" defer=""></script><script src="/_next/static/chunks/main-3cf1b4d0a841b0b4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-32643fc599d68fc0.js" defer=""></script><script src="/_next/static/chunks/116-e8f82ba66f2c41a9.js" defer=""></script><script src="/_next/static/chunks/891-9e24b7718d5823e8.js" defer=""></script><script src="/_next/static/chunks/637-6dfba56d742f678a.js" defer=""></script><script src="/_next/static/chunks/462-29b379b3475d5b09.js" defer=""></script><script src="/_next/static/chunks/pages/courses/spring-security/lessons/authorize-using-spring-beans-27ab51c181301a59.js" defer=""></script><script src="/_next/static/AKH-6cpO_lfOqlDA3-gc2/_buildManifest.js" defer=""></script><script src="/_next/static/AKH-6cpO_lfOqlDA3-gc2/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="header_header___GOuZ sticky-top"><div class="container"><div class="logo_logo__RXjG7 text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div></header><main class="my-3"><div class="container"><section class="header_lessonHeader__jhqot"><div class="float-start">Lesson <!-- -->16<!-- --> of <!-- -->28</div><div class="float-end"><a href="/courses/spring-security">Spring Security</a></div></section><div class="clearfix"></div><div class="mt-5"><div class="float-end"><a href="#" target="_blank" class="icon-link"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/authorize-using-spring-beans" target="_blank" class="icon-link"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><section><h1 class="display-5 mt-2 mb-2">Authorize Using Spring Beans</h1><p class="Heading_underline__sSwtx"></p><p class="Paragraph_paragraph__90U8D">Simple authorization rules can be written using SpEL expressions inside Method security annotations. But there can be rules which are quite harder to write in SpEL, where the expression itself could be better off reside in its own method rather than as a complex String constant.</p></section><section><h3 class="fw-light mt-5 mb-2">Make Instructor&#x27;s profile public</h3><p class="Paragraph_paragraph__90U8D">Let&#x27;s extend the <u>ViewProfile</u> usecase to make Instructor&#x27;s profiles public in addition to viewing one&#x27;s own profile. This can only be done by checking if the requested user profile has Instructor role something like below.</p><div class="border rounded fs-6 my-4"><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
appuser.getRoles()
    .stream()
    .anyMatch(appRole -&gt;
            appRole.getName().equals(RoleEnum.INSTRUCTOR)
    );
</span></code></pre></div><p class="Paragraph_paragraph__90U8D">Is there any simpler way to implement this in SpEL expressions? Well, we can do this using <strong>Spring Beans</strong>. Let&#x27;s define a Spring Bean <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">@Component</mark> to hold a collection of helper methods which can be used to secure your Service layer.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/blob/authorize-using-spring-beans/src/main/java/com/facadecode/spring/security/security/ServiceSecurity.java" target="_blank">ServiceSecurity.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" title="Copy to clipboard"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-meta">@Component(&quot;serviceSecurity&quot;)</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceSecurity</span> {
    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">isInstructor</span><span class="hljs-params">(AppUser appUser)</span> {
      appuser.getRoles()
          .stream()
          .anyMatch(appRole -&gt;
                  appRole.getName().equals(RoleEnum.INSTRUCTOR)
          );
    }
}
</span></code></pre></div><p class="Paragraph_paragraph__90U8D">We can call the above Bean method with the requested user profile as the argument. We can refer the Bean component using it&#x27;s name prefixed with <strong>@</strong> [@serviceSecurity] and we can access the requested user profile from <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">returnObject</mark> inside <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">@PostAuthorize()</mark>. We should combine it with the existing condition with an <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">or</mark> condition like below.</p><div class="border rounded fs-6 my-4"><div class="p-3 bg-light border-bottom"><span class="font-monospace"><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/blob/authorize-using-spring-beans/src/main/java/com/facadecode/spring/security/service/UserService.java" target="_blank">UserService.java</a></span><span class="float-end cursor-pointer" data-bs-toggle="tooltip" title="Copy to clipboard"><i class="bi-clipboard"></i></span></div><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
<span class="hljs-meta">@PreAuthorize(Authority.VIEW_PROFILE)</span>
<span class="hljs-meta">@PostAuthorize(&quot;@serviceSecurity.isInstructor(returnObject) or returnObject.username == authentication.name&quot;)</span>
<span class="hljs-keyword">public</span> AppUser <span class="hljs-title function_">get</span><span class="hljs-params">(Long userId)</span> {
    ...
}
</span></code></pre></div><p class="Paragraph_paragraph__90U8D">Let&#x27;s send the last unauthorized request again to view Gru&#x27;s user profile using <em>Bob</em>&#x27;s credential. We can view the Instructor&#x27;s profile this time.</p><div class="p-3"><div class="mb-3 text-secondary text-center"><em>Authorized request to view Gru (Instructor) profile with Bob&#x27;s credential</em></div><img class="img-fluid rounded border shadow" src="/assets/images/spring-security/lesson16-01.png" alt="Authorized request to view Gru (Instructor) profile with Bob&#x27;s credential"/></div></section><div class="mt-5"><div class="float-end text-secondary"><a href="#" target="_blank" class="icon-link"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/authorize-using-spring-beans" target="_blank" class="icon-link"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><hr class=""/><section><p class="Paragraph_paragraph__90U8D"><span class="float-start"><a href="post-authorize"><i class="bi-arrow-left-short mx-1 align-middle footer_icon__J1tGG"></i>PostAuthorize</a></span><span class="float-end"><a href="domain-object-instance-security">Domain Object Instance Security<i class="bi-arrow-right-short mx-1 align-middle footer_icon__J1tGG"></i></a></span></p><div class="clearfix"></div></section></div></main><footer class="footer_footer__0KXQq"><div class="mt-5 py-5 text-center fw-lighter text-light bg-secondary"><div class="container"><figure><blockquote class="blockquote">I’m not a great programmer; I’m just a good programmer with great habits</blockquote><figcaption class="blockquote-footer text-light">Kent Beck</figcaption></figure></div></div><div class="py-5 bg-dark"><div class="container"><div class="row"><div class="col-9"><div class="logo_logo__RXjG7 text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div><div class="col"><strong>COURSES</strong><ul class="list-unstyled p-0"><li class="my-2"><a href="#">Spring Security</a></li></ul></div></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/courses/spring-security/lessons/authorize-using-spring-beans","query":{},"buildId":"AKH-6cpO_lfOqlDA3-gc2","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>