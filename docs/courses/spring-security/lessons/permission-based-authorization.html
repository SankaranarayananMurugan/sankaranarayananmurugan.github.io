<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/ff92f81931bd1587.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ff92f81931bd1587.css" data-n-g=""/><link rel="preload" href="/_next/static/css/9ec6a016ade6bb0b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9ec6a016ade6bb0b.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-534f50ab9154eb69.js" defer=""></script><script src="/_next/static/chunks/framework-ae4f43955bfa5ddc.js" defer=""></script><script src="/_next/static/chunks/main-3cf1b4d0a841b0b4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-32643fc599d68fc0.js" defer=""></script><script src="/_next/static/chunks/116-e8f82ba66f2c41a9.js" defer=""></script><script src="/_next/static/chunks/891-9e24b7718d5823e8.js" defer=""></script><script src="/_next/static/chunks/637-6dfba56d742f678a.js" defer=""></script><script src="/_next/static/chunks/462-29b379b3475d5b09.js" defer=""></script><script src="/_next/static/chunks/pages/courses/spring-security/lessons/permission-based-authorization-6fea1fa016cf5754.js" defer=""></script><script src="/_next/static/AKH-6cpO_lfOqlDA3-gc2/_buildManifest.js" defer=""></script><script src="/_next/static/AKH-6cpO_lfOqlDA3-gc2/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header class="header_header___GOuZ sticky-top"><div class="container"><div class="logo_logo__RXjG7 text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div></header><main class="my-3"><div class="container"><section class="header_lessonHeader__jhqot"><div class="float-start">Lesson <!-- -->10<!-- --> of <!-- -->28</div><div class="float-end"><a href="/courses/spring-security">Spring Security</a></div></section><div class="clearfix"></div><div class="mt-5"><div class="float-end"><a href="#" target="_blank" class="icon-link"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/permission-based-authorization" target="_blank" class="icon-link"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><section><h1 class="display-5 mt-2 mb-2">Permission Based Authorization</h1><p class="Heading_underline__sSwtx"></p><p class="Paragraph_paragraph__90U8D">We are yet to implement access restrictions to the below three APIs in order to meet the Security objectives defined in the first chapter.</p><table class="table table-striped mb-4"><thead><tr><th>API</th><th>Objective</th></tr></thead><tbody><tr><td>Update Course</td><td>Instructor who created the course can only update it.</td></tr><tr><td>Play Course</td><td>Instructor who created the course can only play it.<br/>Students who are enrolled on the course can only play it.</td></tr><tr><td>View User Profile</td><td>Users can only view their profile.<br/>Any user can view an Instructor&#x27;s profile.</td></tr></tbody></table></section><section><h3 class="fw-light mt-5 mb-2">Downside of Role-based access control</h3><p class="Paragraph_paragraph__90U8D">We can apply role-based restrictions using <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">hasRole()</mark> or <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">hasAnyRole()</mark> on the above API urls. But role-based access control is abstract, coarse grained and less flexible. Any software requirement change in terms of API access control will require code change in the <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">HttpSecurity</mark> configuration.</p><p class="Paragraph_paragraph__90U8D">For example, if the Students can view the list of instructors in order to get the list of courses filtered by the selected instructor, we have to relax the access control to <u>ListInstructors</u> API for both Admin and Student users as below:</p><div class="border rounded fs-6 my-4"><pre class="m-0 px-3 pb-3"><code class="language-java"><span>
http
    .csrf().disable()
    .authorizeRequests(auth -&gt; auth
            .antMatchers(GET, PUBLIC_API_LIST).permitAll()
            .antMatchers(API_LIST_STUDENTS).hasRole(ADMIN.name())
            .antMatchers(API_LIST_INSTRUCTORS).hasAnyRole(ADMIN.name(), STUDENT.name())
            .antMatchers(POST, API_CREATE_COURSES).hasRole(INSTRUCTOR.name())
            .anyRequest().authenticated()
    )
    .httpBasic();
</span></code></pre></div><p class="Paragraph_paragraph__90U8D">So we need a way to define and modify access control dynamically with out changing the code. We can do this by adding another logical layer using Permissions on top of Roles.</p></section><section><h3 class="fw-light mt-5 mb-2">Permissions</h3><p class="Paragraph_paragraph__90U8D">Permission grants the ability to perform an action on a resource. By defining permissions for each action on each resource we can create fine grained access control. In technical terms we can define permissions for each API and then assign them to the appropriate Roles in the database. Similar to <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">hasRole()</mark> Spring Security provides <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">hasAuthority()</mark> method to restrict access to the API urls using these permissions.</p><p class="Paragraph_paragraph__90U8D">So we will define each permission in the format <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">ACTION_RESOURCENAME</mark> corresponding to each APIs. For example, <mark class="font-monospace border rounded p-1 Mark_mark__8gh_T">PLAY_COURSE</mark> permission can be used to grant the ability to access <u>PlayCourse</u> API.</p></section><section><h3 class="fw-light mt-5 mb-2">Key benefits of Permission-based access control</h3><p class="Paragraph_paragraph__90U8D">Securing each API by defining its own permission and then granting those permissions to the roles offer some of the key benefits listed below:</p><ol class="ms-3"><li>No more code modification, as granting permissions to roles is database driven.</li><li>Bird&#x27;s eye view of who can do what in a single place i.e., database.</li><li>Fine grained access control to each API (and other resources).</li><li>Same permission-based access model can be used by both API as well as user interface, as every user action in the UI corresponds to an API execution in the application.</li></ol></section><section><p class="Paragraph_paragraph__90U8D">First let&#x27;s apply the permission based access control for <u>PlayCourse</u> API. We will gradually build the concept in the next three chapters. And in the last chapter we will replace existing role-based access control using permissions.</p></section><div class="mt-5"><div class="float-end text-secondary"><a href="#" target="_blank" class="icon-link"><i class="bi-download fs-5 mx-2 cursor-pointer"></i></a><a href="https://github.com/SankaranarayananMurugan/spring-security-for-developers/tree/permission-based-authorization" target="_blank" class="icon-link"><i class="bi-github fs-5 mx-2 cursor-pointer"></i></a><a href="javascript:void(0)" class="icon-link"><i class="bi-link-45deg fs-5 mx-2 cursor-pointer"></i></a></div><div class="clearfix"></div></div><hr class=""/><section><p class="Paragraph_paragraph__90U8D"><span class="float-start"><a href="current-authenticated-user"><i class="bi-arrow-left-short mx-1 align-middle footer_icon__J1tGG"></i>Current Authenticated User</a></span><span class="float-end"><a href="define-permissions">Define Permissions<i class="bi-arrow-right-short mx-1 align-middle footer_icon__J1tGG"></i></a></span></p><div class="clearfix"></div></section></div></main><footer class="footer_footer__0KXQq"><div class="mt-5 py-5 text-center fw-lighter text-light bg-secondary"><div class="container"><figure><blockquote class="blockquote">I’m not a great programmer; I’m just a good programmer with great habits</blockquote><figcaption class="blockquote-footer text-light">Kent Beck</figcaption></figure></div></div><div class="py-5 bg-dark"><div class="container"><div class="row"><div class="col-9"><div class="logo_logo__RXjG7 text-white py-2"><div class="hstack"><div class="logo_acronym__FiNtE">FC</div><div class="vr"></div><div><div>FACADE</div><div>CODE</div></div></div></div></div><div class="col"><strong>COURSES</strong><ul class="list-unstyled p-0"><li class="my-2"><a href="#">Spring Security</a></li></ul></div></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/courses/spring-security/lessons/permission-based-authorization","query":{},"buildId":"AKH-6cpO_lfOqlDA3-gc2","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>